<!DOCTYPE html>
<html lang="en">
<head>
/jmf-acu/icon0180.png
/jmf-acu/icon0180.png
<meta name="apple-mobile-web-app-title" content="jmf acu">
<meta name="theme-color" content="#4F3D5C">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<title>jmf acu • r2c-visual-freeze-2026-02-09T02:45:10Z</title>
<style>
:root{--bg:#fff;--text:#444;--muted:#666;--card-bg:#fff;--border:#e5e7eb;--accent:#4F3D5C;--accent-text:#fff;--accent-green:#BADA55;--secondary:#666;--danger:#4F3D5C;--radius:12px}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial}
.container{padding:16px;max-width:1100px;margin:0 auto}
.header{display:flex;gap:12px;align-items:flex-start;justify-content:space-between;margin-bottom:8px}
h1{margin:0 0 6px;font:400 28px system-ui;text-transform:lowercase;color:var(--accent)}
.section-title{font:600 20px system-ui;margin-top:20px;color:var(--accent);text-transform:lowercase}
.notice{font-size:12px;color:var(--muted);margin-top:6px}
textarea,input,select{width:100%;padding:10px;font-size:16px;background:var(--card-bg);color:var(--text);border:1px solid var(--border);border-radius:var(--radius)}
textarea.output-box{height:420px;white-space:pre-wrap}
.flex-row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
button{padding:12px 16px;border:0;border-radius:12px;background:var(--accent);color:#fff;font-size:16px;text-transform:lowercase;letter-spacing:.2px;cursor:pointer}
button.secondary{background:var(--secondary)} button.danger{background:var(--danger)} .small-btn{padding:6px 10px;font-size:14px;background:var(--accent-green);color:#0b1324;border-radius:12px}
.preview{margin-top:12px;padding:12px;border:1px solid var(--border);border-radius:12px;background:#fdfdfd}
.preview textarea{height:160px;white-space:pre-wrap}
.card{background:#fafafa;border:1px solid var(--border);border-radius:12px;padding:10px 12px}
.badge{padding:2px 8px;border-radius:999px;background:#f1f5f9;border:1px solid #e2e8f0;color:#475569;margin-right:6px}
.progress-bar{height:10px;background:#eee;border-radius:999px;overflow:hidden;margin:8px 0 12px}
.progress-bar>div{height:100%;width:0;background:var(--accent-green);transition:width .25s ease}

.modal-backdrop{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:9999;align-items:center;justify-content:center;padding:16px}
.modal{width:100%;max-width:720px;background:var(--card-bg);color:var(--text);border:1px solid var(--border);border-radius:16px;padding:16px}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div style="display:flex;gap:12px;align-items:center">
      <div style="width:84px;height:84px;background:#4F3D5C;color:#fff;border-radius:18px;display:flex;align-items:center;justify-content:center;font:600 22px system-ui;flex-direction:column;line-height:1.05"><span>jmf</span><span>acu</span></div>
      <div>
        <h1>jmf acu <span style="font:400 12px system-ui;color:#999">• visual‑freeze</span></h1>
        <div class="notice">same look & sizes as your earlier build • functional fixes under the hood • build: r2c-visual-freeze-2026-02-09T02:45:10Z</div>
        <div class="flex-row" style="margin-top:6px">
          <button id="aiSettingsBtn" class="small-btn">ai settings</button>
          <button id="toggleTools" class="secondary small">show tools</button>
          <button id="toggleCost" class="secondary small">show cost</button>
        </div>
      </div>
    </div>
    <div id="costCard" class="card" style="display:none;min-width:280px;max-width:420px">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div style="font-size:14px;font-weight:600;color:#4F3D5C">estimated cost (this month)</div>
        <div id="costCapText" class="notice">$0 / $15</div>
      </div>
      <div class="progress-bar"><div id="costBarFill"></div></div>
      <div style="display:flex;gap:6px;flex-wrap:wrap">
        <span id="costDollars"   class="badge">$0.00</span>
        <span id="costTokensIn"  class="badge">in: 0 tok</span>
        <span id="costTokensOut" class="badge">out: 0 tok</span>
      </div>
      <div id="costNote" class="notice" style="margin-top:6px">pricing used: $0.15/1m input, $0.60/1m output (change in ai settings).</div>
    </div>
  </div>

  <div class="section-title">transcript input</div>
  <textarea id="inputText" placeholder="paste transcript (60–90 min ok)…"></textarea>
  <div class="flex-row">
    <button id="aiGenerate">ai generate note</button>
    <button id="pasteDemo" class="small-btn">paste test text</button>
    <button id="clearInput" class="danger">clear</button>
  </div>

  <div id="toolsPanel" style="display:none; margin-top:10px; padding:12px; border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc">
    <div class="section-title">quick modules</div>
    <div id="moduleButtons"></div>
    <div class="flex-row">
      <select id="moduleDropdown"></select>
      <button id="insertModule" class="small-btn">insert</button>
    </div>

    <div class="section-title">acupuncture point combos</div>
    <div id="comboButtons"></div>
    <div class="flex-row">
      <select id="comboDropdown"></select>
      <button id="insertCombo" class="small-btn">insert</button>
    </div>

    <div class="section-title">herbal recommendations (patent formulas)</div>
    <div id="herbButtons"></div>
    <div class="flex-row">
      <select id="herbDropdown"></select>
      <button id="insertHerb" class="small-btn">add formula</button>
    </div>

    <div class="section-title">icd-10 favorites</div>
    <div class="flex-row">
      <select id="icdDropdown"></select>
      <button id="addICD" class="small-btn">add to output</button>
    </div>
  </div>

  <div class="preview" id="pass1Preview" style="display:none;">
    <h3 style="margin:0 0 8px;color:#4F3D5C">ai summary preview (from pass 1)</h3>
    <div class="notice">fast outline of captured items.</div>
    <textarea id="pass1Text" readonly></textarea>
  </div>

  <div class="section-title">output note</div>
  <textarea id="outputText" class="output-box" placeholder="your formatted note will appear here…"></textarea>
  <div class="flex-row" style="margin-top:6px">
    <button id="copyNote">copy to clipboard</button>
    <button id="clearOutput" class="danger">clear output</button>
  </div>

</div>

<div id="tpModal" class="modal-backdrop"><div class="modal"><h2>generating note (two‑pass)</h2><div id="tpStep" class="notice">preparing…</div><div class="progress-bar"><div id="tpProg" style="background:var(--accent-green);width:0%"></div></div><div class="notice" id="tpSmall" style="max-height:120px;overflow:auto;white-space:pre-wrap"></div><div style="text-align:right;margin-top:10px;"><button id="tpClose" class="secondary small-btn">close</button></div></div></div>

<div id="aiModalBackdrop" class="modal-backdrop">
  <div class="modal">
    <h2>ai settings</h2>
    <p class="notice">key is stored locally on this device. test before use.</p>
    <div class="grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:8px;">
      <div><label>provider</label><select id="aiProvider"><option value="openai">openai (api.openai.com)</option><option value="azure">azure openai</option></select></div>
      <div><label>model / deployment</label><input id="aiModel" type="text" placeholder="openai: gpt-4o-mini  |  azure: your-deployment-name"></div>
      <div><label>api key</label><input id="aiKey" type="text" placeholder="paste your api key"></div>
      <div><label>base url</label><input id="aiBaseUrl" type="text" placeholder="openai: https://api.openai.com  |  azure: https://YOUR-RESOURCE.openai.azure.com"></div>
      <div><label>azure api version (if azure)</label><input id="aiApiVersion" type="text" placeholder="e.g., 2024-02-15-preview"></div>
      <div><label>temperature</label><input id="aiTemp" type="number" min="0" max="1" step="0.1" value="0.2"></div>
      <div><label>monthly cap ($)</label><input id="aiCap" type="number" min="0" step="1" value="15"></div>
      <div><label>price — input ($ / 1M tokens)</label><input id="aiPriceIn" type="number" min="0" step="0.01" value="0.15"></div>
      <div><label>price — output ($ / 1M tokens)</label><input id="aiPriceOut" type="number" min="0" step="0.01" value="0.60"></div>
    </div>
    <div class="flex-row" style="justify-content:space-between;margin-top:12px;"><span class="notice">keep a hard cap in your openai dashboard.</span><div class="flex-row" style="gap:6px;"><button id="aiTest" class="small-btn">test ai</button><button id="aiSave" class="small-btn">save</button><button id="aiClose" class="secondary small-btn">close</button></div></div>
  </div>
</div>

<script>
const inputEl=document.getElementById('inputText');
const outputEl=document.getElementById('outputText');
const p1WrapEl=document.getElementById('pass1Preview');
const p1TextEl=document.getElementById('pass1Text');

document.getElementById('toggleTools').onclick=()=>{const p=document.getElementById('toolsPanel');const vis=p.style.display!=='none';p.style.display=vis?'none':'block';document.getElementById('toggleTools').textContent=vis?'show tools':'hide tools';};
document.getElementById('toggleCost').onclick=()=>{const c=document.getElementById('costCard');const vis=c.style.display!=='none';c.style.display=vis?'none':'block';document.getElementById('toggleCost').textContent=vis?'show cost':'hide cost';renderCostUI();};

document.getElementById('pasteDemo').onclick=()=>{inputEl.value='l hamstring tight dull after running; worse with stairs and hip flexion. prefers warm water. swims 2x/week, runs 10–15 miles/week. infrared used post-acu. bowel: loose 2x/day; sleep: wakes 3am; urine: dark, frequent.'};
document.getElementById('clearInput').onclick=()=>{inputEl.value='';p1TextEl.value='';p1WrapEl.style.display='none';};
document.getElementById('copyNote').onclick=()=>{outputEl.focus();outputEl.select();try{document.execCommand('copy');}catch{navigator.clipboard.writeText(outputEl.value);}};
document.getElementById('clearOutput').onclick=()=>{outputEl.value='';p1TextEl.value='';p1WrapEl.style.display='none';};

const aiDefaults={provider:'openai',baseUrl:'https://api.openai.com',model:'gpt-4o-mini',apiKey:'',apiVersion:'2024-02-15-preview',temperature:0.2,monthlyCap:15,priceIn:0.15,priceOut:0.60};
function loadAIConfig(){try{return Object.assign({},aiDefaults,JSON.parse(localStorage.getItem('aiConfig')||'{}'));}catch{return {...aiDefaults};}}
function saveAIConfig(c){localStorage.setItem('aiConfig',JSON.stringify(c));renderCostUI();}
const aiModal=document.getElementById('aiModalBackdrop');
document.getElementById('aiSettingsBtn').onclick=()=>{const c=loadAIConfig();document.getElementById('aiProvider').value=c.provider;document.getElementById('aiBaseUrl').value=c.baseUrl;document.getElementById('aiModel').value=c.model;document.getElementById('aiKey').value=c.apiKey;document.getElementById('aiApiVersion').value=c.apiVersion;document.getElementById('aiTemp').value=c.temperature;document.getElementById('aiCap').value=c.monthlyCap;document.getElementById('aiPriceIn').value=c.priceIn;document.getElementById('aiPriceOut').value=c.priceOut;aiModal.style.display='flex';};
document.getElementById('aiClose').onclick=()=>aiModal.style.display='none';
document.getElementById('aiSave').onclick=()=>{const c={provider:document.getElementById('aiProvider').value,baseUrl:(document.getElementById('aiBaseUrl').value||'').trim()||aiDefaults.baseUrl,model:(document.getElementById('aiModel').value||'').trim()||aiDefaults.model,apiKey:(document.getElementById('aiKey').value||'').trim(),apiVersion:(document.getElementById('aiApiVersion').value||'').trim()||aiDefaults.apiVersion,temperature:parseFloat(document.getElementById('aiTemp').value)||aiDefaults.temperature,monthlyCap:Math.max(0,parseFloat(document.getElementById('aiCap').value)||aiDefaults.monthlyCap),priceIn:Math.max(0,parseFloat(document.getElementById('aiPriceIn').value)||aiDefaults.priceIn),priceOut:Math.max(0,parseFloat(document.getElementById('aiPriceOut').value)||aiDefaults.priceOut)};saveAIConfig(c);aiModal.style.display='none';};
document.getElementById('aiTest').onclick=async()=>{const cfg=loadAIConfig();if(!cfg.apiKey){alert('paste your api key first.');return;}try{await aiChat(cfg,[{role:'system',content:'reply with {"ok":true} only (json).'},{role:'user',content:'ping'}]);alert('ai test ok.');}catch(e){alert('ai test failed: '+(e?.message||e));}}

const METER_KEY='costMeter';
function monthKeyNow(){const d=new Date();return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;}
function loadMeter(){const raw=localStorage.getItem(METER_KEY);const mk=monthKeyNow();let obj={month:mk,inTok:0,outTok:0};if(raw){try{obj=JSON.parse(raw)||obj;}catch{}}if(obj.month!==mk)obj={month:mk,inTok:0,outTok:0};return obj;}
function saveMeter(obj){localStorage.setItem(METER_KEY,JSON.stringify(obj));}
function charsToTokens(s){if(!s)return 0;return Math.ceil(s.length/4);} 
function estimateTokens(msgs){let t=0;(msgs||[]).forEach(m=>t+=charsToTokens(m?.content||''));return t;}
function addToMeter(inTok,outTok){const m=loadMeter();m.inTok+=Math.max(0,Math.floor(inTok||0));m.outTok+=Math.max(0,Math.floor(outTok||0));saveMeter(m);renderCostUI();}
function renderCostUI(){const cfg=loadAIConfig();const m=loadMeter();const dollars=(m.inTok/1e6)*cfg.priceIn+(m.outTok/1e6)*cfg.priceOut;document.getElementById('costCapText').textContent=`$${dollars.toFixed(2)} / $${cfg.monthlyCap.toFixed(0)}`;const pct=cfg.monthlyCap>0?Math.min(100,Math.round((dollars/cfg.monthlyCap)*100)):0;const bar=document.getElementById('costBarFill');bar.style.width=pct+'%';bar.style.background='var(--accent-green)';document.getElementById('costDollars').textContent=`$${dollars.toFixed(2)}`;document.getElementById('costTokensIn').textContent=`in: ${m.inTok.toLocaleString()} tok`;document.getElementById('costTokensOut').textContent=`out: ${m.outTok.toLocaleString()} tok`;}

function normalizeLateralityText(s){if(!s)return s;s=s.replace(/\bbilateral\b|\bboth\b/gi,'B').replace(/\bleft\b/gi,'L').replace(/\bright\b/gi,'R').replace(/\brt\b/gi,'R').replace(/\blt\b/gi,'L');s=s.replace(/\b\(?([rlb])\)?(?=\s|:|;|,|\/|-|\)|$)/gi,(_m,g1)=>g1.toUpperCase());s=s.replace(/(^|[\n\r])\s*[–\-•]\s*([rlb])(?=\s|:)/gi,(_m,lead,side)=>`${lead}– ${side.toUpperCase()}`);return s;}
function uppercaseMeridians(s){if(!s)return s;['lv','sp','gb','bl','st','lu','li','si','ht','pc','kd','cv','gv'].forEach(m=>{const r1=new RegExp(`\\b${m}\\b`,'gi');s=s.replace(r1,m.toUpperCase());const r2=new RegExp(`\\b${m}\\s?(\\d+)`,'gi');s=s.replace(r2,(_a,n)=>`${m.toUpperCase()}${n}`);});s=s.replace(/\byin\s?tang\b/gi,'yintang');return s;}
const norm=s=>uppercaseMeridians(normalizeLateralityText(s||''));
function coerceConfidence(v){ if(typeof v!=='number'||!isFinite(v)) return 0.88; if(v<0.75) return 0.88; if(v>0.95) return 0.95; return v; }
function herbFallbackFromTCM(arr){ try{ const txt=(arr||[]).join('; ').toLowerCase(); const picks=[]; const push=x=>{ if(x && !picks.includes(x)) picks.push(x) }; if(/lv qi stagnation|liver qi/.test(txt)){ push('xiao yao wan'); if(/heat|irrit/.test(txt)) push('jia wei xiao yao wan'); } if(/blood stasis/.test(txt)) push('shen tong zhu yu wan'); if(/wind|cold|damp/.test(txt)&&/bi/.test(txt)){ push('du huo ji sheng wan'); push('juan bi wan'); } if(!picks.length) push('shen tong zhu yu wan'); return picks.slice(0,2); }catch{return ['shen tong zhu yu wan'];} }
function renderNote(j){ function bullets(a){return(a||[]).map(s=>'– '+(s||'')).join('\n')} function sections(sec){ if(!sec||!sec.sections) return''; return sec.sections.map(s=>{ let h=norm(s.header||''); let b=bullets((s.bullets||[]).map(norm)); return h+(b?'\n'+b:''); }).join('\n');}
  const hpi='hpi:\n– '+norm(j.hpi||'follow‑up for pain and mobility concerns');
  const subj='subjective:\n'+(sections(j.subjective)||'general\n– no specific subjective items captured');
  const obj='objective:\n'+(sections(j.objective)||'');
  const pc=(j.personal_context&&j.personal_context.length)?('personal context:\n'+bullets((j.personal_context||[]).map(norm))):'';
  const tongue='tongue:\n'+norm(j.tongue||'deduced: not specified');
  const pulse='pulse:\n'+norm(j.pulse||'deduced: not specified');
  const assess='assessment (including tcm diagnosis):\n'+bullets((j.assessment?.bullets||[]).map(norm));
  const tcmdx='tcm diagnosis:\n'+bullets((j.assessment?.tcm_dx||[]).map(norm));
  const principle='treatment principle:\n'+bullets((j.treatment_principle||[]).map(norm));
  const plan=(()=>{ const ch=norm(j.acupuncture_plan?.channels||'LV, SP, GB, BL, ST as indicated; local ashi'); const pts=(j.acupuncture_plan?.points_used||[]).map(norm).join(', '); const ints=bullets((j.acupuncture_plan?.interventions||[]).map(norm)); const adj=bullets((j.acupuncture_plan?.adjuncts||[]).map(norm)); return['acupuncture plan:','acupuncture','– channels: '+ch,'– points used: '+(pts||'as clinically indicated'),ints?ints:'','adjunct therapies',adj?adj:''].filter(Boolean).join('\n');})();
  let herbs='herbal recommendations (patent formulas):\n'+bullets((j.herb_formulas||[]).map(norm)); if(!j.herb_formulas||!j.herb_formulas.length){ herbs='herbal recommendations (patent formulas):\n'+bullets(herbFallbackFromTCM(j.assessment?.tcm_dx||[])); }
  const advice='advice:\n'+bullets((j.advice||[]).map(norm));
  const icd=(j.icd10&&j.icd10.length)?('icd-10 codes:\n'+bullets((j.icd10||[]).map(normalizeLateralityText))):'';
  const note=[hpi,'',subj,'',obj,'',pc?pc+'\n':'',tongue,'',pulse,'',assess,'',tcmdx,'',principle,'',plan,'',herbs,'',advice,'','confidence & assumptions:\n– confidence: '+(typeof j.confidence==='number'?coerceConfidence(j.confidence).toFixed(2):'0.88')].concat(j.assumptions&&j.assumptions.length?bullets(j.assumptions.map(norm)):'').concat(['',icd]).join('\n');
  return note;}

async function aiChat(cfg,messages){
  const base=(cfg.baseUrl||'https://api.openai.com').replace(/\/+$/,'');
  const inTok=estimateTokens(messages);
  let url,headers,body; if(cfg.provider==='azure'){ url=`${base}/openai/deployments/${encodeURIComponent(cfg.model)}/chat/completions?api-version=${encodeURIComponent(cfg.apiVersion)}`; headers={'Content-Type':'application/json','api-key':cfg.apiKey}; body={temperature:cfg.temperature??0.2,messages}; } else { url=`${base}/v1/chat/completions`; headers={'Content-Type':'application/json','Authorization':`Bearer ${cfg.apiKey}`}; body={model:cfg.model||'gpt-4o-mini',temperature:cfg.temperature??0.2,messages}; }
  const resp=await fetch(url,{method:'POST',headers,body:JSON.stringify(body)});
  const text=await resp.text();
  if(!resp.ok){ throw new Error(`api ${resp.status}: ${text}`); }
  let data; try{ data=JSON.parse(text); }catch{ const m=text.match(/\{[\s\S]*\}\s*$/); if(m){ data=JSON.parse(m[0]); } else { throw new Error('could not parse json: '+text.slice(0,200)); } }
  const content=data?.choices?.[0]?.message?.content||data?.choices?.[0]?.text||'';
  addToMeter(inTok, charsToTokens(content));
  return content;
}

async function runTwoPass(){
  const raw=(inputEl.value||'').trim(); if(!raw){ alert('paste a transcript first'); return; }
  const cfg=loadAIConfig(); if(!cfg.apiKey){ alert('open ai settings → paste your api key → save'); return; }
  const modal=document.getElementById('tpModal'); const step=document.getElementById('tpStep'); const prog=document.getElementById('tpProg'); const small=document.getElementById('tpSmall');
  modal.style.display='flex'; step.textContent='pass 1 of 2 — extracting facts…'; prog.style.width='12%'; small.textContent='';
  try{
    const sys1=['you are a careful tcm-intake extractor for an acupuncture clinic.','read ONLY the provided transcript and return STRICT JSON with facts (no prose).','json keys: hpi_bits[], muscles[], rom[], muscle_tests[], personal_context[], tcm_clues[], points_mentioned[], icd_candidates[], herb_candidates[], clinically_relevant[], qa_pairs[]','use lowercase for prose; laterality r/l/b only.'].join('\n');
    const c1=await aiChat(cfg,[{role:'system',content:sys1},{role:'user',content:raw}]);
    let ext; try{ ext=JSON.parse(c1); }catch{ const m=c1.match(/\{[\s\S]*\}\s*$/); if(m){ ext=JSON.parse(m[0]); } else { throw new Error('pass‑1 returned non‑json'); } }
    small.textContent='pass‑1 keys: '+Object.keys(ext||{}).join(', ');

    step.textContent='pass 2 of 2 — drafting final note…'; prog.style.width='68%';
    const sys2=['you are a tcm-savvy clinical scribe for an acupuncture practice.','use ALL extracted facts to write ONE consolidated note matching this schema:','{',' "hpi":"string",',' "subjective": {"sections":[{"header":"string","bullets":["string"]}]},',' "objective":  {"sections":[{"header":"string","bullets":["string"]}]},',' "personal_context":["string"],',' "tongue":"string","pulse":"string",',' "assessment":{"bullets":["string"],"tcm_dx":["string"]},',' "treatment_principle":["string"],',' "acupuncture_plan":{"channels":"string","points_used":["string"],"interventions":["string"],"adjuncts":["string"]},',' "herb_formulas":["string"],',' "advice":["string"],',' "icd10":["string"],',' "confidence":0.82,',' "assumptions":["string"]','}','hard rules: laterality R/L/B only; channels/points UPPERCASE; if tongue/pulse missing, deduce and label as deduced; herbs required (1–2 patent); icd10 3–4 codes; confidence 0.75–0.95.'].join('\n');
    const c2=await aiChat(cfg,[{role:'system',content:sys2},{role:'user',content:JSON.stringify({extracts:[ext]})}]);
    let final; try{ final=JSON.parse(c2); }catch{ const m=c2.match(/\{[\s\S]*\}\s*$/); if(m){ final=JSON.parse(m[0]); } else { throw new Error('pass‑2 returned non‑json'); } }
    final.confidence=coerceConfidence(final.confidence);
    const note=renderNote(final);
    outputEl.value=note; prog.style.width='100%'; step.textContent='done';
  }catch(e){ alert('generation error: '+(e?.message||e)); }
}

document.getElementById('aiGenerate').onclick=runTwoPass;
document.getElementById('tpClose').onclick=()=>{document.getElementById('tpModal').style.display='none';};

const modules={"stress":"general\n– increased stress\n– emotional tension\n","sleep":"general\n– difficulty falling asleep or staying asleep\n"};
const combos={"LV3 + LI4":"LV3, LI4","ST36 + SP6":"ST36, SP6","GB34 + GB41":"GB34, GB41"};
const herbs={"jia wei xiao yao wan":"stress/irritability with heat signs","xiao yao wan":"lv qi stagnation with sp deficiency","du huo ji sheng wan":"chronic wind-cold-damp bi with deficiency"};
const icd=["M54.2 cervicalgia","M79.18 myofascial pain","M54.50 low back pain, unspecified","G47.00 insomnia, unspecified"];
function buildPresets(){ const mb=document.getElementById('moduleButtons'); const md=document.getElementById('moduleDropdown'); for(const k in modules){ const b=document.createElement('button'); b.className='small-btn'; b.textContent=k; b.onclick=()=>{ inputEl.value+=(inputEl.value?'\n':'')+modules[k]; }; mb.appendChild(b); const o=document.createElement('option'); o.value=k; o.textContent=k; md.appendChild(o);} document.getElementById('insertModule').onclick=()=>{ inputEl.value+=(inputEl.value?'\n':'')+modules[md.value]; };
  const cb=document.getElementById('comboButtons'); const cd=document.getElementById('comboDropdown'); for(const k in combos){ const b=document.createElement('button'); b.className='small-btn'; b.textContent=k; b.onclick=()=>{ inputEl.value+=(inputEl.value?' ':'')+combos[k]; }; cb.appendChild(b); const o=document.createElement('option'); o.value=k; o.textContent=k; cd.appendChild(o);} document.getElementById('insertCombo').onclick=()=>{ inputEl.value+=(inputEl.value?' ':'')+combos[cd.value]; };
  const hb=document.getElementById('herbButtons'); const hd=document.getElementById('herbDropdown'); for(const n in herbs){ const b=document.createElement('button'); b.className='small-btn'; b.textContent=n; b.onclick=()=>{ inputEl.value+=` herbal: ${n}${herbs[n]?" ("+herbs[n]+")":""}`; }; hb.appendChild(b); const o=document.createElement('option'); o.value=n; o.textContent=n; hd.appendChild(o);} document.getElementById('insertHerb').onclick=()=>{ const n=hd.value; inputEl.value+=` herbal: ${n}${herbs[n]?" ("+herbs[n]+")":""}`; };
  const id=document.getElementById('icdDropdown'); icd.forEach(code=>{ const o=document.createElement('option'); o.value=code; o.textContent=code; id.appendChild(o); }); document.getElementById('addICD').onclick=()=>{ outputEl.value+=(outputEl.value.trim()?"\n":"")+`icd-10: ${normalizeLateralityText(id.value)}`; };
}
buildPresets();
</script>
</body>
</html>
